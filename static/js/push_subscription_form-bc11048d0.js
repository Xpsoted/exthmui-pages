(function(){var t;t=function(){function t(t){var i;null!=t&&(this.application_server_public_key=window.vapidPublicKey,this.i18n=window.pushSubscriptionI18n,this.container=$("[data-behavior~='subscribe']"),this.switcher=this.container.find("[data-behavior~='form-switcher']"),this.push_supported="serviceWorker"in navigator&&"PushManager"in window,this.findElements(),this.container.on("form-switch",(i=this,function(){return i.findElements()})),this.push_supported?this.registerWorker(t):this.unsupported())}return t.prototype.findElements=function(){if("push_subscription"===this.switcher.val())return this.pushbutton=this.container.find("input[type='submit']"),this.form=this.container.find("[data-subform='push_subscription']"),this.endpoint_field=this.form.find("[data-behavior~='push-endpoint']"),this.key_field=this.form.find("[data-behavior~='push-key']"),this.auth_field=this.form.find("[data-behavior~='push-auth']"),this.pushbutton.length&&this.handleFormSubmit(),this.updateUI()},t.prototype.registerWorker=function(t){return navigator.serviceWorker.register(t).then((s=this,function(t){return s.worker_registration=t,s.worker_registration.pushManager.getSubscription().then(function(t){return s.subscription=t,s.subscription_id=localStorage.getItem("push_subscription")})}))["catch"]((i=this,function(){return i.unsupported()}));var i,s},t.prototype.unsupported=function(){var t;return this.push_supported=!1,(t=this.switcher.find("option[value=push_subscription]")).length&&!t.prop("disabled")&&(t.prop("disabled",!0),t.text(t.text()+window.unsupportedLocale)),this.updateUI()},t.prototype.handleFormSubmit=function(){return this.form.one("submit",(i=this,function(t){return t.preventDefault(),i.pushbutton.prop("disabled",!0),navigator.serviceWorker.ready.then(function(){return null!=i.subscription?i.edit():i.subscribe()})}));var i},t.prototype.subscribe=function(){return this.worker_registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.application_server_public_key}).then((i=this,function(t){return localStorage.removeItem("push_subscription"),i.subscription=t,i.submitForm()}))["catch"]((t=this,function(){return alert(t.i18n.error)}));var t,i},t.prototype.submitForm=function(){var t;return t=this.subscription.toJSON(),this.endpoint_field.val(t.endpoint),this.key_field.val(t.keys.p256dh),this.auth_field.val(t.keys.auth),this.form.submit()},t.prototype.edit=function(){if(null!=this.subscription_id)return window.location="/subscriptions/"+this.subscription_id+"/edit"},t.prototype.updateUI=function(){var t,i;if("push_subscription"===this.switcher.val())return(i=this.form.find(".request-edit-link")).length&&i.remove(),this.pushbutton.length?(this.pushbutton.prop("disabled",!0),this.push_supported?"denied"===Notification.permission?t=this.i18n.pushbutton.blocked:null!=this.subscription?null!=this.subscription_id?(this.pushbutton.prop("disabled",!1),t=this.i18n.pushbutton.edit):t=this.i18n.pushbutton.subscribed:(this.pushbutton.prop("disabled",!1),t=this.i18n.pushbutton["default"]):t=this.i18n.pushbutton.unsupported,this.pushbutton.val(t)):void 0},t}(),$loaded(function(){return new t("/serviceworker.js")})}).call(this);